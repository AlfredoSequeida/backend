# REST API

Things to know:
- For responses, `...` is not valid JSON, it indicates there are more results not shown to simplify output.
- For responses, the data is filler data, 0 means the data is of type `Number` while `""` means
  the data is of type `String`.
- Since Uber acquired Postmates, the API data seems to be the same for both. A search using both
  websites while monitoring the network tab in Chrome dev tools show the API endpoints have the
  same names. Additionally, the data returned is the same both on the website and with the 
  returned JSON data.

## Search

- Do not use this endpoint for autocompleting search results, use the autocomplete search endpoint
  instead (not yet completed).

### Usage example
```javascript
const options = {
  method: "GET",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    query: "pizza",
    location: { longitude: 34.09533691, latitude: -118.12718201 },
  }),
};

fetch("localhost:8000/api/search", options)
  .then((response) => response.json())
  .then((response) => console.log(response))
  .catch((err) => console.error(err));
```

### Response example
```json
[
  {
    "service": "postmates",
    "stores": [
      {
        "id": "",
        "title": "",
        "location": { "latitude": 0, "longitude": 0 },
        "deliveryFee": 0,
        "estimatedDeliveryTime": 0,
        "rating": 0,
        "image": ""
      }
    ]
  },
  {"service": "grubhub", stores: [{},{},{}, ...]},
  ...
]
```

### Notes
- Errors that take place will replace the `stores` array with an `errors` object, an example can
  be found below:
  ```json
  [
   {
     "service": "postmates",
     "stores": [{},{},{}, ...]
   }
   {
     "service": "grubhub",
     "error": {status: 403, statusText: "Unauthorized"}
   },
   ...
  ]   
  ```
-  Refer to example response for types
- `estimatedDeliveryTime` is in minutes
- `deliveryFee` is in USD
- `rating` is out of 5 and depending on the platform it can be a float value
- `deliveryFee` seem to be promotional values ie: $0 on your first order, so they should not
   be used to calculate final costs.
- Some stores don't have ratings, if that's the case, a `null` rating will be returned
- Postmates (Web API)
  - There does not seem to be a way to pass in location data directly, from manual testing
    of the web API, there seems to be three steps, but I have not been able to get the
    location to be set.
    - (1) search for location (by address/zip)
    - (2) get location data with previous data from step 1 
    - (3) call setLocation api
  
    I'm assuming that the setLocation API might be using a session token to
    keep track of the location in their backend. I also tried making the calls
    using the same cookie without success. Need to investigate further.
- Doordash (Web API vs Mobile API)
  - Still doing research on the doordash mobile API tokens, they can be created, but compared to the
    tokens generated by the mobile app, tokens seem to be less stable (more rate limiting)
  - Compared to the web API, the mobile API does not provide location data for the
    search endpoint. But the mobile API is the better API to use since it allows location
    as part of the query, so we can search different locations. Here are some ideas if we need
    the location data from this endpoint (at the time of search):
      - Query both Web and Mobile endpoints and merge the data (this could be seen as a lot of queries to the Doordash API, resulting in their servers rate limiting us)
      - Make another call to get detailed information for all restaurants (same potential issue as above)
      - Pull the location data from another source like google maps API or something similar. 
- The following maps the supported JSON search parameters to each service. As APIs
  continue to be developed, more parameters will be supported
    - query:
      - Postmates, Grubhub, DoorDash
    - location:
      - Grubhub, DoorDash
